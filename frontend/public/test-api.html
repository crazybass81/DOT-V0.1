<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API 테스트</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #fafafa;
        }
        .test-section h3 {
            margin-top: 0;
            color: #666;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 3px;
            box-sizing: border-box;
        }
        textarea {
            min-height: 100px;
            resize: vertical;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>DOT Platform API 테스트</h1>

        <!-- Health Check 테스트 -->
        <div class="test-section">
            <h3>1. Health Check 테스트</h3>
            <button onclick="testHealthCheck()">GET /api/v1/health</button>
            <div id="health-result" class="result"></div>
        </div>

        <!-- 회원가입 테스트 -->
        <div class="test-section">
            <h3>2. 회원가입 테스트</h3>
            <input id="register-email" type="email" placeholder="이메일" value="test@example.com">
            <input id="register-password" type="password" placeholder="비밀번호" value="Test123!">
            <input id="register-name" type="text" placeholder="이름" value="테스트사용자">
            <input id="register-phone" type="text" placeholder="전화번호" value="010-1234-5678">
            <button onclick="testRegister()">POST /api/v1/auth/register</button>
            <div id="register-result" class="result"></div>
        </div>

        <!-- 직접 API 호출 테스트 -->
        <div class="test-section">
            <h3>3. 커스텀 API 호출</h3>
            <select id="custom-method">
                <option value="GET">GET</option>
                <option value="POST">POST</option>
                <option value="PUT">PUT</option>
                <option value="DELETE">DELETE</option>
            </select>
            <input id="custom-path" type="text" placeholder="API 경로 (예: auth/register)" value="auth/register">
            <textarea id="custom-body" placeholder="요청 본문 (JSON)">
{
  "email": "custom@example.com",
  "password": "Test123!",
  "name": "커스텀사용자",
  "phone": "010-9876-5432"
}
            </textarea>
            <button onclick="testCustomAPI()">API 호출</button>
            <div id="custom-result" class="result"></div>
        </div>

        <!-- 연결 정보 -->
        <div class="test-section">
            <h3>4. 연결 정보</h3>
            <p><strong>현재 도메인:</strong> <span id="current-domain"></span></p>
            <p><strong>API Base URL:</strong> <span id="api-base-url"></span></p>
            <p><strong>브라우저 User Agent:</strong> <span id="user-agent"></span></p>
        </div>
    </div>

    <script>
        // 페이지 로드 시 정보 표시
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('current-domain').textContent = window.location.origin;
            document.getElementById('api-base-url').textContent = '/api/v1';
            document.getElementById('user-agent').textContent = navigator.userAgent;
        });

        // Health Check 테스트
        async function testHealthCheck() {
            const resultDiv = document.getElementById('health-result');
            resultDiv.className = 'result info';
            resultDiv.textContent = '요청 중...';

            try {
                const response = await fetch('/api/v1/health', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.text();

                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `성공 (${response.status})\n\n${data}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `실패 (${response.status})\n\n${data}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `네트워크 오류: ${error.message}`;
            }
        }

        // 회원가입 테스트
        async function testRegister() {
            const resultDiv = document.getElementById('register-result');
            resultDiv.className = 'result info';
            resultDiv.textContent = '요청 중...';

            const requestData = {
                email: document.getElementById('register-email').value,
                password: document.getElementById('register-password').value,
                name: document.getElementById('register-name').value,
                phone: document.getElementById('register-phone').value
            };

            try {
                const response = await fetch('/api/v1/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });

                const data = await response.text();

                if (response.ok || response.status === 409) { // 409는 중복 오류로 정상 응답
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `응답 (${response.status})\n\n요청 데이터:\n${JSON.stringify(requestData, null, 2)}\n\n응답 데이터:\n${data}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `실패 (${response.status})\n\n요청 데이터:\n${JSON.stringify(requestData, null, 2)}\n\n응답 데이터:\n${data}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `네트워크 오류: ${error.message}\n\n요청 데이터:\n${JSON.stringify(requestData, null, 2)}`;
            }
        }

        // 커스텀 API 호출
        async function testCustomAPI() {
            const resultDiv = document.getElementById('custom-result');
            resultDiv.className = 'result info';
            resultDiv.textContent = '요청 중...';

            const method = document.getElementById('custom-method').value;
            const path = document.getElementById('custom-path').value;
            const bodyText = document.getElementById('custom-body').value.trim();

            let requestBody = null;
            if (method !== 'GET' && bodyText) {
                try {
                    requestBody = JSON.parse(bodyText);
                } catch (e) {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `JSON 파싱 오류: ${e.message}`;
                    return;
                }
            }

            try {
                const url = `/api/v1/${path}`;
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                };

                if (requestBody) {
                    options.body = JSON.stringify(requestBody);
                }

                const response = await fetch(url, options);
                const data = await response.text();

                const logData = {
                    url: url,
                    method: method,
                    requestBody: requestBody,
                    responseStatus: response.status,
                    responseData: data
                };

                if (response.ok || response.status === 409) {
                    resultDiv.className = 'result success';
                } else {
                    resultDiv.className = 'result error';
                }

                resultDiv.textContent = `${method} ${url}\n상태: ${response.status}\n\n요청:\n${JSON.stringify(requestBody, null, 2)}\n\n응답:\n${data}`;

            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `네트워크 오류: ${error.message}`;
            }
        }

        // 엔터 키로 테스트 실행
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && e.ctrlKey) {
                if (e.target.closest('.test-section')) {
                    const section = e.target.closest('.test-section');
                    const button = section.querySelector('button');
                    if (button) button.click();
                }
            }
        });
    </script>
</body>
</html>